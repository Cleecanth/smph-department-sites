!function(e){function i(){this.instances={},this.init=function(i){return this.instances[i.id]={items:[],opts:{},id:i.id,domelm:i,hover:e(s).clone()},this.instances[i.id]},this.hasCaption=function(i,t){if(""!=t.items[i].caption){var n="<h3 class='capt-title'>"+t.items[i].text+"</h3>",a=["<div class='capt'>","<a href='"+t.items[i].link+"'>",n,t.items[i].caption,"<span class='capt-more'>Read more</span>","</a>","</div>"].join("");e(t.domelm).find(".banner-caption").html(a).show()}else e(t.domelm).find(".banner-caption").empty().hide()},this.itemevent=function(i,t){if(e(i).hasClass("banner-nav-item")||(i=e(i).parent()),i!=a){var n=e(i).data("bannerItemCount");if("vertical"==t.opts.navdirection){var s=i.length>0?e(i).position().top:e(t.domelm).position().top;e(i).toggleClass("active-item").siblings().removeClass("active-item"),e(t.domelm).find(".banner-nav").prepend(e(t.hover).css("top",s).show()),e(t.hover).find(".banner-item-hover-img"),e(t.domelm).find(".holder").css("width","40px").animate({width:"230px"},150)}else if("animate"==t.opts.eventType){var o=i.length>0?e(i).position().left:e(t.domelm).position().left;e(i).toggleClass("active-item").siblings().removeClass("active-item"),e(t.domelm).find(".banner-nav").prepend(e(t.hover).css("left",o).show()),e(t.hover).find(".banner-item-hover-img"),e(t.domelm).find(".holder").css("width","40px").animate({width:"230px"},150)}else e(t.domelm).find(".banner-nav div[class*='-active']").each(function(){e(this).removeClass("item-"+e(this).data("bannerItemCount")+"-active")}),e(i).addClass("item-"+n+"-active");e(t.domelm).find("*[id^='object-']").not("*[id='object-"+n+"']").hide(),e(t.domelm).find("*[id='object-"+n+"']").show(),t.opts.captions?banner.hasCaption(n,t):e(t.domelm).find(".banner-caption").hide(),t.player.stop(),a=i}},this.preloadObjects=function(i,t){for(var n in i.items){var a;if("video"==i.items[n].type){var s=i.items[n].file,a=e('<div id="object-'+n+'" style="width:100%;" />'),o=e('<span class="loading" />'),r=e('<div id="ytplayer-container" />');r.tubeplayer({initialVideo:s,height:232,width:600,onPlayerPlaying:function(){i.player.stop()},onErrorNotFound:function(){e("#object-"+n).addClass("error").empty().html('<h2>Error: video could not be found.</h2><a href="'+i.items[n].link+'" alt="'+i.items[n].text+'">View headline story here.</a>')},onErrorNotEmbeddable:function(){e("#object-"+n).addClass("error").empty().html('<h2>Error: video could not be embedded.</h2><a href="'+i.items[n].link+'" alt="'+i.items[n].text+'">View headline story here.</a>')},onErrorInvalidParameter:function(){e("#object-"+n).addClass("error").empty().html('<h2>Error: video has invalid parameter.</h2><a href="'+i.items[n].link+'" alt="'+i.items[n].text+'">View headline story here.</a>')}}),e(a).append(o).append(r),t.append(a)}else{e(i.domelm).find(".banner-img").css({background:"url("+i.items[n].file+")","padding-left":"0px"}),e(i.domelm).find(".banner-display");var d;d=null!=i.items[n].image?i.items[n].image:e("<img src='"+i.items[n].file+"' />"),a="undefined"!=typeof i.items[n].link&&""!=i.items[n].link?e("<a id='object-"+n+"' href='"+i.items[n].link+"'></a>").append(d):e(d).attr("id","object-"+n),t.append(a)}}},this.buildNav=function(i){var t=e("<div/>").addClass("banner-nav"),n=Math.min(28,100/i.items.length)+"%";for(var a in i.items){var s=e("<div/>").addClass("banner-nav-item").addClass("item-"+a).css({height:n,width:n}).data("bannerItemCount",a).click(function(t){var n=t.srcElement?t.srcElement:t.target;e(n).hasClass("banner-nav-item")&&(n=e(n).find(".banner-nav-item-text")),banner.itemevent(n,i)});"video"!=i.items[a].type?e(s).append(e("<span class='banner-nav-item-text'/>").css({"background-image":"url("+i.items[a].file+")",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+i.items[a].file+",sizingMethod='scale')"}).html(i.items[a].text)):e(s).append(e("<span class='banner-nav-item-text'/>").css({"background-image":"url(http://img.youtube.com/vi/"+i.items[a].file+"/1.jpg)",filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(src='http://img.youtube.com/vi/"+i.items[a].file+"/1.jpg',sizingMethod='scale')"}).html(i.items[a].text)),"video"==i.items[a].type&&e(s).find("span").addClass("isMovie"),e(t).append(s)}return t}}function t(i,t,n){t.items=[],e(i).find("item").each(function(){var i={};e(this).children().each(function(){i[e(this)[0].nodeName]=e(e(this)[0]).text()}),t.items.push(i)}),e(i).find("settings > param").each(function(){t.opts[e(this).attr("name")]=e(this).text()}),n()}function n(i,t,n){var a,s=-1,o=i;n.id;this.play=function(){s<o.length-1?s+=1:s=0,banner.itemevent(e(".item-"+s),n),a=setTimeout("banner.instances."+n.id+".player.play()",n.opts.delay)},this.stop=function(){clearTimeout(a)}}var a,s=e("<div/>").hide().addClass("banner-item-hover").append(e("<div class='holder'/>")).append(e("<div class='banner-item-hover-img'/>"));e.fn.bannerwidget=function(a){return"undefined"==typeof a?"This plugin requires User Settings.":this.each(function(){"undefined"==typeof banner&&(banner=new i);var s=banner.init(e(this)[0]);s.opts={imgdir:"files/bannerwidget/"},e.extend(s.opts,a);var o=e(this);if(s.settings=e.ajax({url:s.opts.settingsFile,async:!0,dataType:"xml",error:function(e,i){}}),"404"==s.settings.status)return"Settings File Not Found";var r=e("<div/>").addClass("banner-display").append(e("<div class='banner-img'>")).append(e("<div class='banner-caption'/>"));return s.settings.success(function(i,a,d){t(d.responseXML,s,function(){banner.preloadObjects(s,e(r).find(".banner-img"));var i=banner.buildNav(s);"top"==s.opts.navposition||"left"==s.opts.navposition?o.append(i).append(r):o.append(r).append(i),s.player=new n(s.items,e(".banner-img"),s),s.player.play()})}),!0})}}(jQuery);